# Bug ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
ç”¨æˆ·åœ¨æ‰§è¡Œè„šæœ¬æ—¶é‡åˆ°é”™è¯¯ï¼š
```
/dev/fd/63: line 313: : No such file or directory
```

## é—®é¢˜åˆ†æž

### æ ¹æœ¬åŽŸå› 
åœ¨ `install.sh` è„šæœ¬ä¸­ï¼Œ`CONFIG_FILE` å˜é‡æ²¡æœ‰åœ¨è„šæœ¬å¼€å¤´æ­£ç¡®å®šä¹‰ï¼Œå¯¼è‡´åœ¨ `create_initial_config()` å‡½æ•°ä¸­ä½¿ç”¨ heredoc æ—¶ï¼Œå˜é‡ä¸ºç©ºå€¼ï¼Œäº§ç”Ÿäº†ç©ºå‘½ä»¤ã€‚

### é”™è¯¯ä½ç½®
- **æ–‡ä»¶**: `install.sh`
- **è¡Œå·**: ç¬¬313è¡Œ `cat > "$CONFIG_FILE" << EOF`
- **é—®é¢˜**: `$CONFIG_FILE` å˜é‡æœªå®šä¹‰ï¼Œå¯¼è‡´å‘½ä»¤å˜æˆ `cat > "" << EOF`

### é”™è¯¯è¯¦æƒ…
1. `CONFIG_FILE` å˜é‡å®šä¹‰åœ¨ `download_script()` å‡½æ•°å†…éƒ¨çš„ heredoc ä¸­
2. è¿™ä¸ªå®šä¹‰å®žé™…ä¸Šæ˜¯å†™å…¥åˆ°ç”Ÿæˆçš„è„šæœ¬æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ `install.sh` ä¸­ç”Ÿæ•ˆ
3. å½“ `create_initial_config()` å‡½æ•°æ‰§è¡Œæ—¶ï¼Œ`$CONFIG_FILE` ä¸ºç©º
4. å¯¼è‡´ `cat > "" << EOF` å‘½ä»¤è¯­æ³•é”™è¯¯

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤å†…å®¹
åœ¨ `install.sh` è„šæœ¬çš„å…¨å±€å˜é‡éƒ¨åˆ†æ·»åŠ  `CONFIG_FILE` å˜é‡å®šä¹‰ï¼š

```bash
# å…¨å±€å˜é‡
SCRIPT_NAME="sing-box"
SCRIPT_PATH="/usr/local/bin/sing-box"
CONFIG_DIR="/etc/sing-box"
DATA_DIR="/usr/local/etc/sing-box"
LOG_DIR="/var/log/sing-box"
CONFIG_FILE="$CONFIG_DIR/config.json"  # æ–°å¢žæ­¤è¡Œ
SERVICE_FILE="/etc/systemd/system/sing-box.service"
SINGBOX_VERSION="latest"
```

### ä¿®å¤ä½ç½®
- **æ–‡ä»¶**: `install.sh`
- **è¡Œå·**: ç¬¬21è¡Œï¼ˆåœ¨ `LOG_DIR` å®šä¹‰åŽï¼‰
- **ä¿®æ”¹**: æ·»åŠ  `CONFIG_FILE="$CONFIG_DIR/config.json"`

## éªŒè¯æ–¹æ³•

### è¯­æ³•æ£€æŸ¥
```bash
# æ£€æŸ¥è„šæœ¬è¯­æ³•
bash -n install.sh
bash -n sing-box.sh
```

### å˜é‡éªŒè¯
```bash
# éªŒè¯å˜é‡å®šä¹‰
grep -n "CONFIG_FILE=" install.sh
```

## é¢„é˜²æŽªæ–½

### 1. å˜é‡å®šä¹‰è§„èŒƒ
- æ‰€æœ‰å…¨å±€å˜é‡åº”åœ¨è„šæœ¬å¼€å¤´ç»Ÿä¸€å®šä¹‰
- é¿å…åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å…¨å±€å˜é‡
- ä½¿ç”¨ `set -u` æ£€æµ‹æœªå®šä¹‰å˜é‡

### 2. è¯­æ³•æ£€æŸ¥
- å¼€å‘è¿‡ç¨‹ä¸­å®šæœŸä½¿ç”¨ `bash -n` æ£€æŸ¥è¯­æ³•
- ä½¿ç”¨ `shellcheck` å·¥å…·è¿›è¡Œé™æ€åˆ†æž
- æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

### 3. é”™è¯¯å¤„ç†
- åœ¨å…³é”®æ“ä½œå‰æ£€æŸ¥å˜é‡æ˜¯å¦å·²å®šä¹‰
- æ·»åŠ é€‚å½“çš„é”™è¯¯æç¤ºä¿¡æ¯
- ä½¿ç”¨ `set -e` åœ¨é”™è¯¯æ—¶ç«‹å³é€€å‡º

## ç›¸å…³æ–‡ä»¶

### å·²ä¿®å¤
- âœ… `install.sh` - æ·»åŠ  CONFIG_FILE å˜é‡å®šä¹‰

### éœ€è¦éªŒè¯
- ðŸ” `sing-box.sh` - æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜
- ðŸ” æ‰€æœ‰ heredoc è¯­å¥ - ç¡®ä¿å˜é‡æ­£ç¡®å®šä¹‰

## æµ‹è¯•å»ºè®®

### åŸºç¡€æµ‹è¯•
1. è¯­æ³•æ£€æŸ¥é€šè¿‡
2. å˜é‡å®šä¹‰æ­£ç¡®
3. è„šæœ¬å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼ˆåœ¨é€‚å½“çŽ¯å¢ƒä¸­ï¼‰

### åŠŸèƒ½æµ‹è¯•
1. å®‰è£…æµç¨‹å®Œæ•´æ€§
2. é…ç½®æ–‡ä»¶ç”Ÿæˆæ­£ç¡®
3. æœåŠ¡åˆ›å»ºæˆåŠŸ

## ç‰ˆæœ¬æ›´æ–°

ä¿®å¤å®ŒæˆåŽï¼Œå»ºè®®æ›´æ–°ç‰ˆæœ¬å·ï¼š
- å½“å‰ç‰ˆæœ¬: v1.0.0
- å»ºè®®ç‰ˆæœ¬: v1.0.1
- æ›´æ–°å†…å®¹: ä¿®å¤ CONFIG_FILE å˜é‡æœªå®šä¹‰é—®é¢˜

---

**ä¿®å¤æ—¶é—´**: 2024å¹´
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: ðŸ” å¾…éªŒè¯