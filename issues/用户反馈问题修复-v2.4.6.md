# 用户反馈问题修复 - v2.4.6

## 问题概述

用户反馈了四个主要问题：
1. 节点无法正常使用
2. `sb`快捷命令失效（Windows环境）
3. 二维码显示为图片而非终端显示
4. VLESS协议需要使用`www.yahoo.com`域名

## 解决方案实施

### 1. VLESS域名配置修复

**问题**: VLESS协议需要使用`www.yahoo.com`域名

**解决方案**:
- 修改 `lib/protocols.sh` 文件
- 在 `detect_reality_target` 函数中添加 `www.yahoo.com:443` 到目标列表
- 将默认目标从 `www.microsoft.com:443` 更改为 `www.yahoo.com:443`

**修改文件**: `lib/protocols.sh`

### 2. Windows快捷命令修复

**问题**: Windows环境下`sb`快捷命令失效

**解决方案**:
- 在 `singbox-install.sh` 中添加 `create_shortcut_command` 函数
- 支持跨平台快捷命令创建（Linux/Windows）
- Windows环境创建 `.bat` 和 `.ps1` 文件
- Linux环境使用传统的符号链接方式
- 修复批处理文件中的路径变量引用问题

**修改文件**: `singbox-install.sh`

### 3. 终端二维码显示功能

**问题**: 二维码只保存为图片文件，未在终端显示

**解决方案**:
- 修改 `lib/subscription.sh` 文件
- 添加 `install_qrcode_terminal` 函数，自动安装 `qrcode-terminal`
- 支持 npm/yarn 安装，如果没有则自动安装 Node.js
- 修改 `generate_qr_codes` 函数，同时支持：
  - 终端显示二维码（使用 `qrcode-terminal`）
  - 保存为PNG文件（使用 `qrencode`）
  - 显示分享链接文本

**修改文件**: `lib/subscription.sh`

### 4. 节点配置优化

**问题**: 节点无法正常使用

**解决方案**:
- 通过修复VLESS域名配置解决连接问题
- 确保使用 `www.yahoo.com` 作为Reality目标
- 优化二维码和配置文件生成逻辑

## 技术实现细节

### 跨平台快捷命令创建

```bash
create_shortcut_command() {
    # 检测操作系统类型
    if [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "cygwin" ]] || [[ -n "$WINDIR" ]]; then
        # Windows 环境：创建 .bat 和 .ps1 文件
    else
        # Linux/Unix 环境：使用符号链接
    fi
}
```

### 终端二维码显示

```bash
# 终端显示二维码
if command -v qrcode-terminal >/dev/null 2>&1; then
    echo -e "${CYAN}协议名称 二维码 (终端显示):${NC}"
    qrcode-terminal "$share_link"
fi

# 保存为文件
qrencode -t PNG -o "$qr_file" "$share_link"
```

### Node.js自动安装

支持多种Linux发行版的Node.js自动安装：
- Ubuntu/Debian: 使用 NodeSource 仓库
- CentOS/RHEL/Fedora: 使用 NodeSource RPM 仓库
- 自动安装 `qrcode-terminal` 全局包

## 版本更新

- 版本号: `v2.4.5` → `v2.4.6`
- 更新文件: `VERSION`

## 测试建议

1. **Windows环境测试**:
   - 验证 `sb.bat` 和 `sb.ps1` 命令是否正常工作
   - 测试在 CMD 和 PowerShell 中的兼容性

2. **Linux环境测试**:
   - 验证 `/usr/local/bin/sb` 符号链接是否正常
   - 测试快捷命令功能

3. **二维码功能测试**:
   - 验证终端二维码显示
   - 确认PNG文件正常生成
   - 测试分享链接的有效性

4. **VLESS连接测试**:
   - 使用 `www.yahoo.com` 域名测试连接
   - 验证Reality配置的正确性

## 兼容性说明

- **操作系统**: 支持 Linux、Windows (WSL/MSYS2/Cygwin)
- **依赖**: 自动安装 Node.js 和 qrcode-terminal
- **向后兼容**: 保持原有功能不变，仅增强体验

## 后续优化建议

1. 添加更多Reality目标域名选项
2. 优化Windows环境下的路径处理
3. 增加二维码显示的自定义选项
4. 添加配置验证和连接测试功能