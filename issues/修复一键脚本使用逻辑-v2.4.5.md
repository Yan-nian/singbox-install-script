# 修复一键脚本使用逻辑问题 - v2.4.5

## 问题描述

用户反馈：安装/更新后使用 `sb` 唤起时不应该再安装一遍。

## 问题分析

### 当前问题

1. **双重安装检查逻辑不一致**：
   - `sb.sh`（yonggekkk脚本）检查：`/etc/systemd/system/sing-box.service`
   - `singbox-install.sh`（我们的脚本）检查：`$SINGBOX_BINARY` 文件

2. **符号链接冲突**：
   - `sb.sh` 创建的快捷命令可能指向不同的脚本
   - `singbox-install.sh` 也创建 `/usr/local/bin/sb` 符号链接

3. **重复安装触发**：
   - 用户使用 `sb` 命令时，可能调用错误的脚本
   - 导致重新进入安装流程

### 根本原因

- 两个不同的 Sing-box 管理脚本共存
- 安装状态检查标准不统一
- 快捷命令指向不明确

## 解决方案

### 方案一：统一安装状态检查（推荐）

**优点**：
- 兼容性好，支持多种安装方式
- 不破坏现有用户环境
- 检查逻辑更全面

**实施步骤**：
1. 修改 `singbox-install.sh` 的安装检查逻辑
2. 增加多重检查机制
3. 智能识别已安装状态
4. 提供安装状态诊断功能

### 方案二：脚本分离管理（彻底解决）

**优点**：
- 彻底避免冲突
- 各自独立管理
- 用户选择明确

**实施步骤**：
1. 检测现有安装方式
2. 提供迁移选项
3. 创建独立的快捷命令
4. 清理冲突的符号链接

## 推荐实施方案一

### 技术实现要点

1. **增强安装状态检查**：检查二进制文件、系统服务、配置文件等多个维度
2. **智能主函数逻辑**：根据检测结果选择合适的处理方式
3. **迁移管理菜单**：为用户提供清晰的选择选项
4. **安装诊断功能**：帮助用户了解当前安装状态

### 预期效果

1. **智能识别**：自动识别不同的安装方式
2. **避免冲突**：不会重复安装已存在的 Sing-box
3. **用户友好**：提供清晰的选择和迁移选项
4. **诊断功能**：帮助用户了解当前安装状态
5. **兼容性**：支持多种安装方式共存