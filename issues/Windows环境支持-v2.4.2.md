# Windows 环境支持开发任务 - v2.4.2

## 任务背景

用户反映在 Windows 环境中无法使用 `sb` 快捷命令唤起交互面板。原因是脚本中的 `ln -sf "$SCRIPT_DIR/singbox-install.sh" /usr/local/bin/sb` 命令是为 Linux 系统设计的，在 Windows 环境中不适用。

## 问题分析

### 根本原因
1. **系统差异**: 脚本主要为 Linux 系统设计，使用了 Linux 特有的软链接机制
2. **路径问题**: Windows 和 Linux 的路径格式不同
3. **环境依赖**: Windows 缺少原生的 bash 环境

### 影响范围
- Windows 用户无法使用快捷命令 `sb`
- 需要每次输入完整路径启动脚本
- 用户体验较差

## 解决方案

### 方案设计

提供两种 Windows 环境下的快捷启动方案：

#### 方案 1: 批处理文件 (sb.bat)
- **优点**: Windows 原生支持，无需额外配置
- **功能**: 自动检测 bash 环境，传递参数
- **兼容性**: 支持所有 Windows 版本

#### 方案 2: PowerShell 脚本 (sb.ps1)
- **优点**: 更强大的脚本功能，更好的错误处理
- **功能**: 彩色输出，参数处理，环境检测
- **要求**: 可能需要修改执行策略

### 实现细节

#### 1. 创建 sb.bat
- **文件**: `sb.bat`
- **功能**: 
  - 检测主脚本存在性
  - 查找 bash 环境
  - 传递命令行参数
  - 提供友好的错误提示

#### 2. 创建 sb.ps1
- **文件**: `sb.ps1`
- **功能**:
  - PowerShell 原生参数处理
  - 彩色输出支持
  - 更详细的错误信息
  - 自动环境检测

#### 3. 创建使用文档
- **文件**: `WINDOWS_USAGE.md`
- **内容**:
  - 详细的使用说明
  - 环境配置指南
  - 故障排除方案
  - 常见问题解答

#### 4. 更新主文档
- **文件**: `README.md`
- **更新**:
  - 添加 Windows 使用说明
  - 环境要求说明
  - 快捷命令使用方法

## 技术实现

### 文件结构
```
singbox/
├── singbox-install.sh          # 主脚本
├── sb.bat                       # Windows 批处理快捷脚本
├── sb.ps1                       # PowerShell 快捷脚本
├── WINDOWS_USAGE.md             # Windows 使用指南
├── README.md                    # 更新的主文档
└── VERSION                      # 版本号 v2.4.2
```

### 核心代码逻辑

#### sb.bat 核心逻辑
```batch
@echo off
# 1. 检测主脚本存在性
# 2. 查找 bash 命令
# 3. 执行脚本并传递参数
# 4. 错误处理和用户提示
```

#### sb.ps1 核心逻辑
```powershell
# 1. 参数处理
# 2. 路径检测
# 3. bash 环境检测
# 4. 脚本执行
# 5. 错误处理和彩色输出
```

## 环境要求

### 必需环境
用户需要安装以下任一 bash 环境：

1. **Git for Windows** (推荐)
   - 轻量级，专为 Windows 设计
   - 自动添加 bash 到 PATH
   - 下载: https://git-scm.com/download/win

2. **Windows Subsystem for Linux (WSL)**
   - 完整的 Linux 环境
   - 安装: `wsl --install`
   - 文档: https://docs.microsoft.com/zh-cn/windows/wsl/install

3. **Cygwin**
   - 提供完整的 POSIX 环境
   - 下载: https://www.cygwin.com/

## 使用方法

### 基本使用
```cmd
# 启动交互式菜单
sb.bat

# 或使用 PowerShell
.\sb.ps1
```

### 参数传递
```cmd
# 显示帮助
sb.bat --help

# 直接安装
sb.bat --install

# 卸载
sb.bat --uninstall
```

### 添加到 PATH (可选)
用户可以将脚本目录添加到系统 PATH，实现全局访问：
```cmd
# 添加到 PATH 后可直接使用
sb
```

## 测试验证

### 测试场景
1. **环境检测**: 验证 bash 环境检测功能
2. **参数传递**: 测试各种命令行参数
3. **错误处理**: 验证错误提示和处理
4. **兼容性**: 测试不同 Windows 版本

### 预期结果
- ✅ 成功检测并启动 bash 环境
- ✅ 正确传递命令行参数
- ✅ 友好的错误提示信息
- ✅ 与原有功能完全兼容

## 版本更新

### 版本号变更
- **从**: v2.4.1
- **到**: v2.4.2
- **类型**: 功能增强版本

### 更新内容
1. 新增 Windows 环境支持
2. 创建快捷启动脚本
3. 完善文档说明
4. 提升用户体验

## 后续优化

### 短期计划
1. 收集用户反馈
2. 优化错误提示
3. 增加更多环境检测

### 长期计划
1. 考虑原生 Windows 版本
2. 图形界面支持
3. 自动环境配置

## 总结

通过本次更新，成功解决了 Windows 环境中 `sb` 快捷命令无法使用的问题。提供了两种可靠的解决方案，并完善了相关文档。用户现在可以在 Windows 环境中方便地使用快捷命令启动 sing-box 管理脚本。

### 关键成果
- ✅ 解决了 Windows 环境兼容性问题
- ✅ 提供了多种快捷启动方案
- ✅ 完善了使用文档和指南
- ✅ 保持了与原有功能的兼容性
- ✅ 提升了整体用户体验