# 统一终端二维码大小 - v2.4.10

## 问题概述

用户反馈终端中各个协议显示的二维码大小不一致，需要统一成 hy2 的二维码大小。

## 问题分析

通过代码分析发现，终端二维码大小不一致的问题源于两套不同的二维码生成机制：

1. **lib/subscription.sh** 中的 `generate_qr_codes()` 函数：所有协议都使用了 `qrcode-terminal --small` 参数
2. **scripts/protocols/*.sh** 中的独立生成函数：只使用 `qrencode` 生成文件，没有终端显示功能
3. **scripts/menu.sh** 中的 `generate_qr_codes()` 函数：调用的是各协议独立函数，缺少终端显示

## 修复方案

采用方案1：统一使用 lib/subscription.sh 的实现

### 技术实现

**修改文件**：`scripts/menu.sh`

**修改内容**：
```bash
generate_qr_codes() {
    # 调用 lib/subscription.sh 中统一的二维码生成实现
    # 该实现已经统一使用 --small 参数，确保所有协议的终端二维码大小一致
    source "$SCRIPT_DIR/../lib/subscription.sh"
    generate_qr_codes
}
```

### 修复效果

1. **统一二维码大小**：所有协议的终端二维码都使用 `--small` 参数
2. **保持功能完整**：既有终端显示又有文件保存
3. **代码简化**：避免重复实现，便于维护
4. **用户体验改善**：二维码大小一致，便于扫描

## 修改文件清单

1. **scripts/menu.sh**
   - 重构 `generate_qr_codes()` 函数
   - 调用 lib/subscription.sh 中的统一实现
   - 确保所有协议二维码大小一致

2. **VERSION**
   - 更新版本号到 v2.4.10

## 测试验证

### 功能测试
1. 生成 VLESS Reality 二维码，验证终端显示使用 `--small` 参数
2. 生成 VMess WebSocket 二维码，验证终端显示使用 `--small` 参数
3. 生成 Hysteria2 二维码，验证终端显示使用 `--small` 参数
4. 确认所有协议的二维码大小一致

### 兼容性测试
1. 验证文件二维码生成功能正常
2. 确认分享链接显示正常
3. 测试在不同终端环境下的显示效果

## 技术优势

1. **代码复用**：避免重复实现，提高代码质量
2. **统一标准**：所有协议使用相同的二维码生成逻辑
3. **易于维护**：集中管理二维码生成功能
4. **向后兼容**：保持原有功能不变

## 用户体验改进

1. **视觉一致性**：所有协议的二维码大小统一
2. **扫描便利性**：适中的二维码大小便于手机扫描
3. **终端友好**：适合终端环境显示的尺寸

## 版本信息

- **版本号**：v2.4.10
- **修复类型**：用户体验优化
- **影响范围**：二维码生成功能
- **兼容性**：完全向后兼容

## 后续优化建议

1. 考虑添加二维码大小配置选项
2. 支持更多二维码显示格式
3. 优化二维码生成性能
4. 添加二维码质量检测功能