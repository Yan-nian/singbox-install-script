# Sing-box 一键安装脚本使用说明

## 概述

本脚本是一个功能完整的 Sing-box 服务器端一键安装和配置工具，支持多种主流代理协议，提供友好的交互界面和完善的管理功能。

## 支持的协议

### 1. VLESS Reality Vision
- **特点**: 最新的无特征代理协议，具有极强的抗检测能力
- **适用场景**: 网络环境严格的地区
- **端口**: 默认 443 (可自定义)
- **加密**: 基于 TLS 1.3 和 Reality 技术

### 2. VMess WebSocket
- **特点**: 成熟稳定的代理协议，兼容性好
- **适用场景**: 一般网络环境，支持 CDN 中转
- **端口**: 默认 8080 (可自定义)
- **传输**: WebSocket 协议

### 3. VMess WebSocket + TLS
- **特点**: 在 VMess WebSocket 基础上增加 TLS 加密
- **适用场景**: 需要更高安全性的环境
- **端口**: 默认 8443 (可自定义)
- **加密**: TLS 1.3

### 4. Hysteria2
- **特点**: 基于 QUIC 的高性能代理协议
- **适用场景**: 高带宽需求，游戏加速
- **端口**: 默认 36712 (可自定义)
- **传输**: UDP (QUIC)

## 快速开始

### 1. 下载并运行脚本

```bash
# 下载脚本
wget -O install.sh https://raw.githubusercontent.com/your-repo/singbox-install/main/install.sh

# 添加执行权限
chmod +x install.sh

# 运行脚本
./install.sh
```

### 2. 使用交互菜单

脚本启动后会显示主菜单，包含以下选项：

- **1. 安装 Sing-box**: 自动下载并安装最新版本
- **2. 配置协议**: 配置各种代理协议
- **3. 管理服务**: 启动、停止、重启服务
- **4. 查看配置**: 查看和管理配置信息
- **5. 系统工具**: 系统检查和优化工具
- **6. 卸载 Sing-box**: 完全卸载程序和配置
- **0. 退出脚本**: 退出安装脚本

## 详细使用指南

### 安装 Sing-box

1. 选择菜单选项 `1`
2. 脚本会自动：
   - 检测系统环境
   - 下载适合的 Sing-box 版本
   - 安装到系统目录
   - 创建系统服务
   - 配置基础环境

### 配置协议

#### 单协议配置

1. 选择菜单选项 `2`
2. 选择要配置的协议：
   - `1`: VLESS Reality Vision
   - `2`: VMess WebSocket
   - `3`: VMess WebSocket + TLS
   - `4`: Hysteria2

#### 多协议配置

1. 选择菜单选项 `2`
2. 选择 `5. 多协议配置`
3. 输入要启用的协议编号（用空格分隔）
   - 例如：`1 2 4` 表示启用 VLESS、VMess 和 Hysteria2

#### 协议配置详情

**VLESS Reality Vision 配置**
- 自动生成 UUID
- 自动生成 Reality 密钥对
- 自动选择目标网站（如 www.microsoft.com）
- 可自定义端口和服务器名称

**VMess WebSocket 配置**
- 自动生成 UUID
- 自动生成 WebSocket 路径
- 可选择是否启用 TLS
- 支持自签名证书或自定义证书

**Hysteria2 配置**
- 自动生成密码和混淆密码
- 自动检测带宽
- 支持自签名证书
- 可配置伪装网站

### 服务管理

选择菜单选项 `3` 进入服务管理：

- **启动服务**: 启动 Sing-box 服务
- **停止服务**: 停止 Sing-box 服务
- **重启服务**: 重启 Sing-box 服务
- **重新加载配置**: 不重启服务的情况下重新加载配置
- **查看服务状态**: 显示详细的服务状态信息
- **查看日志**: 实时查看服务日志
- **启用/禁用开机自启**: 管理开机自启动

### 查看配置

选择菜单选项 `4` 查看和管理配置：

- **查看配置信息**: 显示当前配置摘要
- **查看客户端配置**: 显示生成的客户端配置文件
- **生成分享链接**: 生成各协议的分享链接
- **生成 QR 码**: 生成二维码（需要安装 qrencode）
- **验证配置文件**: 检查配置文件语法
- **编辑配置文件**: 手动编辑配置
- **备份/恢复配置**: 配置文件的备份和恢复

### 系统工具

选择菜单选项 `5` 使用系统工具：

- **系统信息检查**: 显示系统详细信息
- **网络连通性测试**: 测试网络连接
- **端口占用检查**: 检查端口使用情况
- **防火墙配置**: 自动配置防火墙规则
- **系统优化**: 优化系统参数
- **更新脚本**: 检查和更新脚本
- **清理临时文件**: 清理系统临时文件
- **重置所有配置**: 重置到初始状态

## 客户端配置

### 获取客户端配置

配置完成后，可以通过以下方式获取客户端配置：

1. **查看分享链接**: 菜单 `4` -> `3`
2. **生成 QR 码**: 菜单 `4` -> `4`
3. **下载配置文件**: 配置文件保存在 `/var/lib/sing-box/` 目录

### 客户端软件推荐

**移动端**
- Android: sing-box for Android
- iOS: sing-box for iOS (需要 TestFlight)

**桌面端**
- Windows: sing-box, v2rayN
- macOS: sing-box, ClashX Meta
- Linux: sing-box

**路由器**
- OpenWrt: sing-box
- 梅林固件: sing-box

## 常见问题

### 1. 安装失败

**问题**: 下载 Sing-box 失败
**解决**: 
- 检查网络连接
- 尝试更换下载源
- 手动下载并放置到指定目录

### 2. 服务启动失败

**问题**: 服务无法启动
**解决**:
- 检查配置文件语法: 菜单 `4` -> `5`
- 查看服务日志: 菜单 `3` -> `6`
- 检查端口占用: 菜单 `5` -> `3`

### 3. 客户端连接失败

**问题**: 客户端无法连接
**解决**:
- 检查防火墙设置
- 验证配置信息是否正确
- 测试网络连通性: 菜单 `5` -> `2`

### 4. Reality 协议问题

**问题**: Reality 连接不稳定
**解决**:
- 更换目标网站
- 检查服务器名称配置
- 确保时间同步

### 5. Hysteria2 速度慢

**问题**: Hysteria2 速度不理想
**解决**:
- 调整带宽设置
- 检查 UDP 连接
- 优化系统参数: 菜单 `5` -> `5`

## 高级配置

### 自定义配置

如需自定义配置，可以：

1. 使用菜单 `4` -> `6` 编辑配置文件
2. 直接编辑 `/var/lib/sing-box/config.json`
3. 使用自定义模板文件

### 多端口配置

脚本支持同时配置多个协议，每个协议使用不同端口：

- VLESS Reality: 443
- VMess WebSocket: 8080
- VMess WebSocket TLS: 8443
- Hysteria2: 36712

### 证书管理

**自动证书**:
- 脚本会自动生成自签名证书
- 证书保存在 `/var/lib/sing-box/certs/` 目录

**自定义证书**:
- 将证书文件放置到指定目录
- 修改配置文件中的证书路径

## 安全建议

1. **定期更新**: 保持 Sing-box 和脚本为最新版本
2. **强密码**: 使用复杂的密码和 UUID
3. **防火墙**: 只开放必要的端口
4. **监控**: 定期检查服务状态和日志
5. **备份**: 定期备份配置文件

## 性能优化

1. **系统优化**: 使用菜单 `5` -> `5` 进行系统优化
2. **内核参数**: 调整网络相关内核参数
3. **BBR 加速**: 启用 BBR 拥塞控制算法
4. **资源监控**: 监控 CPU 和内存使用情况

## 故障排除

### 日志分析

查看详细日志信息：

```bash
# 查看服务日志
journalctl -u sing-box -f

# 查看配置验证
sing-box check -c /var/lib/sing-box/config.json

# 查看网络连接
netstat -tlnp | grep sing-box
```

### 健康检查

使用菜单 `5` -> `1` 进行系统健康检查，自动诊断常见问题。

### 重置配置

如果遇到无法解决的问题，可以使用菜单 `5` -> `8` 重置所有配置。

## 更新和维护

### 更新 Sing-box

```bash
# 重新运行安装脚本
./install.sh

# 选择菜单 1 重新安装
```

### 更新脚本

使用菜单 `5` -> `6` 检查和更新脚本到最新版本。

### 配置备份

建议定期备份配置：

```bash
# 手动备份
cp /var/lib/sing-box/config.json /backup/sing-box-$(date +%Y%m%d).json

# 或使用脚本功能
# 菜单 4 -> 7
```

## 技术支持

如果遇到问题，可以：

1. 查看本文档的常见问题部分
2. 检查 GitHub Issues
3. 提交新的 Issue 并提供详细信息：
   - 系统信息
   - 错误日志
   - 配置文件（去除敏感信息）
   - 复现步骤

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。