# 更新日志

本文档记录了 Sing-box 一键配置脚本的所有重要更改。

## [v1.0.6] - 2024年7月17日

### 🚀 重大更新 - 配置模板优化
- **学习优秀配置模板**: 参考 https://blog.rewired.moe/post/sing-box-config/ 博客文章
- **全面升级配置模板**: 采用先进的配置模板，大幅提升功能和性能

### ✨ 主配置模板更新
- **日志优化**: 调整日志级别为 error，减少不必要的日志输出
- **DNS 配置**: 添加完整的 DNS 配置，支持分流和智能解析
- **实验性功能**: 启用缓存文件功能，提升性能
- **Clash API**: 添加 Clash API 支持，兼容 Clash 客户端
- **TUN 接口**: 添加完整的 TUN 接口配置，支持系统级代理
- **混合代理**: 添加 HTTP/SOCKS 混合代理端口

### 🎯 出站配置优化
- **节点选择器**: 添加手动选择节点功能
- **自动选择**: 添加 URL 测试自动选择最佳节点
- **故障转移**: 添加故障转移功能，提升稳定性
- **智能更新**: 自动更新选择器出站列表

### 🛣️ 路由规则升级
- **规则集支持**: 添加 geosite-cn, geoip-cn, category-ads-all 规则集
- **CDN 加速**: 使用 Fastly CDN 加速规则集下载
- **完整分流**: 支持国内直连、广告拦截等完整分流规则
- **模式切换**: 支持 Clash 模式切换（Direct/Proxy）

### 🔧 协议配置优化
- **VLESS Reality**: 添加 sniff、domain_strategy 等优化选项
- **VMess**: 优化 WebSocket 传输，添加 Headers 配置
- **Hysteria2**: 添加流量嗅探和域名策略优化
- **Shadowsocks**: 添加连接优化和嗅探功能

### 🎪 新增功能
- **初始化函数**: 自动初始化目录结构和配置文件
- **智能缓存**: 自动管理缓存文件和数据库
- **配置同步**: 自动同步节点选择器配置

### 📈 性能提升
- **缓存优化**: 启用 fake IP 缓存，提升解析速度
- **DNS 优化**: 智能 DNS 分流，减少解析延迟
- **连接优化**: 优化连接处理和域名策略
- **资源优化**: 使用 CDN 加速资源下载

---

## [v1.0.5] - 2024年7月17日

### 🚀 重大更新
- **集成安装脚本**: 将 `install.sh` 升级为集成式安装/更新/覆盖脚本
- **智能检测**: 自动识别系统安装状态，选择最佳安装方式
- **多模式支持**: 支持新安装、更新、升级、重装等多种模式
- **自动备份**: 更新前自动备份现有配置和脚本文件
- **部分更新**: 支持仅更新核心程序或管理脚本
- **服务管理**: 智能处理服务启动、停止和重启

### ✨ 新增功能
- 新增命令行参数支持：
  - `-h, --help`: 显示帮助信息
  - `-f, --force`: 强制重新安装
  - `-u, --update`: 更新模式
  - `-c, --core`: 仅更新核心程序
  - `-s, --script`: 仅更新管理脚本
- 新增安装状态检测和智能模式选择
- 新增版本检查，避免重复安装相同版本
- 新增完整的备份机制

### 🐛 Bug 修复
- 修复交互式界面数字输入无响应问题
- 修复脚本覆盖安装时的权限问题
- 修复版本获取失败时的错误处理

---

## [v1.0.4] - 2024年

### 🐛 Bug 修复
- 修复 `install.sh` 中全局变量（如 `CONFIG_DIR`, `DATA_DIR`, `CONFIG_FILE`）的定义顺序和重复定义问题，解决了 `touch: cannot touch '': No such file or directory` 错误。

---

## [v1.0.3] - 2024年

### 🐛 Bug 修复
- 修复 `install.sh` 中 `CONFIG_FILE` 变量的重复定义问题。

---

## [v1.0.2] - 2024年

### 📝 文档更新
- **改进**: 更新 README.md 安装说明，提供本地安装和远程安装两种方式
- **新增**: `DEPLOYMENT.md` - 详细的部署指南和问题解决方案
- **修复**: 修正安装链接指向错误仓库的问题
- **优化**: 添加用户名占位符提醒，避免链接错误

### 🔧 改进
- **部署**: 提供完整的 Git 部署流程
- **验证**: 添加语法检查和功能测试指南
- **通知**: 明确用户问题解决方案和重新安装步骤

### 🚨 重要说明
- 解决了用户执行远程旧版本脚本导致的错误问题
- 推荐使用本地克隆方式安装以确保使用最新修复版本

---

## [v1.0.1] - 2024年

### 🐛 Bug 修复
- **修复**: 修复 `install.sh` 中 `CONFIG_FILE` 变量未定义导致的语法错误
- **问题**: 在 `create_initial_config()` 函数中使用未定义的 `$CONFIG_FILE` 变量
- **解决**: 在全局变量部分添加 `CONFIG_FILE="$CONFIG_DIR/config.json"` 定义
- **影响**: 解决了脚本执行时 `/dev/fd/63: line 313: : No such file or directory` 错误

### 📝 文档更新
- **新增**: `BUGFIX.md` - 详细的问题分析和修复报告
- **新增**: `test_syntax.sh` - 语法检查测试脚本
- **新增**: `CHANGELOG.md` - 版本更新历史记录

### 🔧 改进
- **优化**: 改进了变量定义的规范性
- **增强**: 添加了语法检查工具

---

## [v1.0.0] - 2024年

### 🎉 首次发布

#### ✨ 核心功能
- **协议支持**: VLESS Reality、VMess、Hysteria2 三种协议
- **一键安装**: 自动化安装和配置流程
- **配置管理**: 添加、删除、查看、修改配置
- **分享功能**: 生成分享链接和二维码
- **服务管理**: 启动、停止、重启、状态查看
- **系统管理**: 完整卸载、日志查看

#### 📁 项目结构
- `install.sh` - 一键安装脚本
- `sing-box.sh` - 主管理脚本
- `README.md` - 详细使用文档
- `需求文档.md` - 项目需求分析
- `实现计划.md` - 开发计划和技术细节
- `LICENSE` - GPL v3 开源协议

#### 🛠️ 技术特性
- **系统支持**: Ubuntu、Debian、CentOS
- **架构支持**: amd64、arm64、armv7
- **自动化**: 依赖安装、目录创建、服务配置
- **安全性**: Reality 协议、TLS 加密
- **易用性**: 命令行界面、帮助文档

#### 📋 支持的命令
```bash
# 基础命令
sing-box add <protocol>     # 添加配置
sing-box list               # 列出配置
sing-box info <name>        # 查看详情
sing-box del <name>         # 删除配置
sing-box url <name>         # 获取分享链接
sing-box qr <name>          # 生成二维码
sing-box port <name> <port> # 更换端口

# 系统管理
sing-box start              # 启动服务
sing-box stop               # 停止服务
sing-box restart            # 重启服务
sing-box status             # 查看状态
sing-box log                # 查看日志
sing-box uninstall          # 卸载脚本

# 其他
sing-box version            # 显示版本
sing-box help               # 显示帮助
```

#### 🎯 设计目标
- **简单易用**: 一键安装，简单配置
- **功能完整**: 涵盖常用代理协议
- **维护方便**: 模块化设计，易于扩展
- **安全可靠**: 遵循最佳实践

---

## 版本说明

### 版本号格式
采用语义化版本控制 (Semantic Versioning):
- **主版本号**: 不兼容的 API 修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

### 更新类型
- 🎉 **新功能** (Features)
- 🐛 **Bug修复** (Bug Fixes)
- 📝 **文档** (Documentation)
- 🔧 **改进** (Improvements)
- ⚡ **性能** (Performance)
- 🔒 **安全** (Security)
- 💥 **破坏性变更** (Breaking Changes)

### 支持政策
- **当前版本**: 完全支持，持续更新
- **前一版本**: 安全更新和重要修复
- **更早版本**: 仅安全更新

---

**维护者**: Sing-box 脚本开发团队  
**许可证**: GPL v3  
**仓库**: https://github.com/your-repo/sing-box-script